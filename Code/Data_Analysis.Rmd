---
title: "Data Analysis"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r library}
library(tidyverse)
library(lubridate)
#install.packages("trend") - runs stationary tests
library(trend)
#install.packages("zoo") - replaces missing values in time series
library(zoo)
#install.packages("Kendall") - specific to one stationary test to be performed
library(Kendall)
#install.packages("tseries")
library(tseries)
library(RColorBrewer)
library(viridis)
library(pals)


#set theme
mytheme <- theme_classic(base_size = 14) + 
  theme(axis.text = element_text(color = "black"), 
        legend.position = "right", 
        legend.box.background = element_rect(color="black"), legend.background = element_blank(),  
        plot.title=element_text(hjust = 0.5))
#makes font size bigger, puts legend on right, puts box around legend, centers title in middle
theme_set(mytheme) #setting for all subsequent plots
```

```{r processed.data}
Poop_raw <- read.csv("./Data/Raw/FAOSTAT_data_1980_2050.csv", stringsAsFactors = TRUE)

#filter for desired variables
Poop_filtered <- Poop_raw %>% 
  select(Element, Item, Year:Value)

#filter for CH4 data
Poop_CH4 <- Poop_filtered %>% 
  filter(Element == "Emissions (CH4) (Manure management)")  
  
#filter to remove projected data (removed 2030 and 2050 to eliminate empty years for time series) 
CH4_time <- Poop_CH4 %>% 
  filter(Year %in% c(1980:2018))

#separate items into individual columns
CH4_items <- pivot_wider(CH4_time, names_from=Item, values_from=Value)

```



```{r}
#simple visualization of methane emissions from animals 
CH4_plot <- ggplot(CH4_time, aes(x=Year, y=Value, color=Item))+
  geom_line(size=1.1)+
  labs(y="Methane (gigagrams)", title = "Methane Emissions by Animals", col="Animal")
print(CH4_plot)
```

```{r Time.Series.Cattle.Dairy}
#Create time series component dor dairy cattle
CH4_cattle_dairy_ts <- ts(CH4_items$`Cattle, dairy`, start=1980, end=2018)

#Run Mann-Kendall test to test for trend
CH4_cattle_dairy_mk <- mk.test(CH4_cattle_dairy_ts)
CH4_cattle_dairy_mk

#Plot time series
plot.ts(CH4_cattle_dairy_ts)

Cattle_dairy_plot <-
ggplot(CH4_items, aes(x = Year, y = `Cattle, dairy`)) +
  geom_line() +
  labs(y="CH4 Emissions (gigagrams)", title="Methane Emissions for Dairy Cattle", x="Year") +
  geom_smooth( method = lm )
print(Cattle_dairy_plot)

```


```{r Time.Series.Swine.Market}
#Create time series component for market swine
CH4_swine_market_ts <- ts(CH4_items$`Swine, market`, start=1980, end=2018)

#Run Mann-Kendall test to test for trend
CH4_swine_market_mk <- mk.test(CH4_swine_market_ts)
CH4_swine_market_mk

#Plot time series
plot.ts(CH4_swine_market_ts)


Swine_market_plot <-
ggplot(CH4_items, aes(x = Year, y = `Swine, market`)) +
  geom_line() +
  labs(y="CH4 Emissions (gigagrams)", title="Methane Emissions for Market Swine", x="Year") +
  geom_smooth( method = lm )
print(Swine_market_plot)
```



```{r}
CH4_asses <- CH4_time %>% 
  filter(Item=="Asses")

CH4_asses_ts <- ts(CH4_asses$Value, start=1980, end=2018, frequency=1)
CH4_asses_decomposed <- stl(CH4_asses_ts, s.window = "periodic")

#use a cowplot
#use plot.ts or ts.plot
#pivot wider to separate items
#trend for time series

```


